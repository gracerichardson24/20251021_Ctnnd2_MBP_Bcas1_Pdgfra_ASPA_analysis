---
title: "Pdgfra"
format: html
---

```{r}
#packages
if(!require(lsmeans)){install.packages("lsmeans")}
if(!require(multcompView)){install.packages("multcompView")}
if(!require(dplyr)){install.packages("dplyr")}
if(!require(rcompanion)){install.packages("rcompanion")}
if(!require(rcompanion)){install.packages("ggprism")}

library(tidyverse)
library(stringr)
library(car)
library(FSA)
library(ggpubr)
library(ggbeeswarm)
library(ggprism)
library(ragg)

if(!require(psych)){install.packages("psych")}
if(!require(FSA)){install.packages("FSA")}
if(!require(lattice)){install.packages("lattice")}
if(!require(lsr)){install.packages("lsr")}
```

```{r}
#reading in csv files and cleaning

Section_data_Pdgfra <- read.csv("DATA/Pdgfra/PdgfraImagedata_20250917_CTNND2_ASTRO_oligstain_juvenile_set2_ASPA_Pdgfra.csv")

#adding column for Animal, Sex, GT, slice, hemisphere

Section_data_Pdgfra <- Section_data_Pdgfra %>%
  mutate(
    Animal = str_extract(Image, "_\\d{6}_") %>%
                str_replace_all("_", ""),
    Sex = str_extract(Image, "_[FM]_") %>%
             str_replace_all("_", ""),
    Genotype = str_extract(Image, "_(WT|KO)_") %>% 
      str_replace_all("_", ""),
    Slice = str_extract(Image, "s\\d+") %>%
      str_replace("s", ""),
    Hemisphere = str_extract(Image, "h\\d+") %>%
      str_replace("h", "")
  )



Detections_data_Pdgfra <- read.csv("DATA/Pdgfra/PdgfraCelldata_20250917_CTNND2_ASTRO_oligstain_juvenile_set2_ASPA_Pdgfra.csv")

#adding column for Animal, Sex, GT, slice, hemisphere

Detections_data_Pdgfra <- Detections_data_Pdgfra %>%
  mutate(
    Animal = str_extract(Image, "_\\d{6}_") %>%
                str_replace_all("_", ""),
    Sex = str_extract(Image, "_[FM]_") %>%
             str_replace_all("_", ""),
    Genotype = str_extract(Image, "_(WT|KO)_") %>% 
      str_replace_all("_", ""),
    Slice = str_extract(Image, "s\\d+") %>%
      str_replace("s", ""),
    Hemisphere = str_extract(Image, "h\\d+") %>%
      str_replace("h", "")
  )
```

```{r}
#reading in csv files and cleaning

Section_data_ASPA <- read.csv("DATA/ASPA/ASPAImagedata_20250917_CTNND2_ASTRO_oligstain_juvenile_set2_ASPA_Pdgfra.csv")

#adding column for Animal, Sex, GT, slice, hemisphere

Section_data_ASPA <- Section_data_ASPA %>%
  mutate(
    Animal = str_extract(Image, "_\\d{6}_") %>%
                str_replace_all("_", ""),
    Sex = str_extract(Image, "_[FM]_") %>%
             str_replace_all("_", ""),
    Genotype = str_extract(Image, "_(WT|KO)_") %>% 
      str_replace_all("_", ""),
    Slice = str_extract(Image, "s\\d+") %>%
      str_replace("s", ""),
    Hemisphere = str_extract(Image, "h\\d+") %>%
      str_replace("h", "")
  )



Detections_data_ASPA <- read.csv("DATA/ASPA/ASPACelldata_20250917_CTNND2_ASTRO_oligstain_juvenile_set2_ASPA_Pdgfra.csv")

#adding column for Animal, Sex, GT, slice, hemisphere

Detections_data_ASPA <- Detections_data_ASPA %>%
  mutate(
    Animal = str_extract(Image, "_\\d{6}_") %>%
                str_replace_all("_", ""),
    Sex = str_extract(Image, "_[FM]_") %>%
             str_replace_all("_", ""),
    Genotype = str_extract(Image, "_(WT|KO)_") %>% 
      str_replace_all("_", ""),
    Slice = str_extract(Image, "s\\d+") %>%
      str_replace("s", ""),
    Hemisphere = str_extract(Image, "h\\d+") %>%
      str_replace("h", "")
  )
```

```{r}
combined_ASPAPdgra <- full_join(
  Section_data_ASPA,
  Section_data_Pdgfra,
  by = c("Animal", "Name", "Sex", "Image", "Object.type", "Num.Detections", "Genotype", "Slice", "Hemisphere")
)

combined_ASPAPdgra <- combined_ASPAPdgra |>
  mutate(
    `ASPA/total` = Num.ASPA./Num.Detections,
    `Pdgfra/total` = Num.Pdgfra./Num.Detections,
    `ASPA+/Pdgfra-` = Num.ASPA./Num.Pdgfra..1,
    `ASPA+/Pdgfra+` = Num.ASPA./Num.Pdgfra.,
    `ASPA-/Pdgfra+` = Num.ASPA..1/Num.Pdgfra.,
    `ASPA-/Pdgfra-` = Num.ASPA..1/Num.Pdgfra..1
  )

combined_ASPAPdgra <- combined_ASPAPdgra |>
  group_by(Animal, Sex, Genotype) |>
  summarise(
    Num.Pdgfra. = mean(Num.Pdgfra.),
    Num.Pdgfra..1 = mean(Num.Pdgfra..1),
    Num.ASPA. = mean(Num.ASPA.),
    Num.ASPA.1 = mean(Num.ASPA..1),
    Num.Detections = mean(Num.Detections),
    `ASPA/total` = mean(`ASPA/total`),
    `Pdgfra/total` = mean(`Pdgfra/total`),
    `ASPA+/Pdgfra-` = mean(`ASPA+/Pdgfra-`),
    `ASPA+/Pdgfra+` = mean(`ASPA+/Pdgfra+`),
    `ASPA-/Pdgfra+` = mean(`ASPA-/Pdgfra+`),
    `ASPA-/Pdgfra-` = mean(`ASPA-/Pdgfra-`)
  )

```

```{r}
#arcsin(sqrt) stretches out values near 0 and compresses values near 1, stabilizes variance for proportion analysis
combined_ASPAPdgra_clean <- combined_ASPAPdgra[!is.na(combined_ASPAPdgra$`ASPA/total`), ]
nrow(combined_ASPAPdgra_clean)
combined_ASPAPdgra_clean$ASPA_trans <- asin(sqrt(combined_ASPAPdgra_clean$`ASPA/total`))


#t-test
t.test(ASPA_trans ~ Genotype, data = combined_ASPAPdgra_clean)

```

```{r}
#arcsin(sqrt) stretches out values near 0 and compresses values near 1, stabilizes variance for proportion analysis
combined_ASPAPdgra_clean <- combined_ASPAPdgra[!is.na(combined_ASPAPdgra$`Pdgfra/total`), ]
nrow(combined_ASPAPdgra_clean)
combined_ASPAPdgra_clean$Pdgfra_trans <- asin(sqrt(combined_ASPAPdgra_clean$`Pdgfra/total`))


#t-test
t.test(Pdgfra_trans ~ Genotype, data = combined_ASPAPdgra_clean)
```
